<form class="m-5" [formGroup]="productbatchForm" (ngSubmit)="onSubmit()">
  <div class="card mb-4">
    <div class="card-body">
      <div class="row">
        <div class="col-md-8">
          <label class="form-label">Category</label>
          <select class="form-select" formControlName="cat_id">
            <option value="">-- Select Category --</option>
            <option *ngFor="let cat of categories" [value]="cat.cat_id">
              {{ cat.name }}
            </option>
          </select>
          <div
            *ngIf="
              productbatchForm.get('cat_id')?.invalid &&
              productbatchForm.get('cat_id')?.touched
            "
            class="text-danger small"
          >
            Category is required
          </div>
        </div>
      </div>
    </div>
  </div>

  <div formArrayName="products" class="mb-3">
    <div
      *ngFor="let product of products.controls; let i = index"
      [formGroupName]="i"
      class="mb-4"
    >
      <input
        type="text"
        class="form-control mb-2"
        formControlName="name"
        placeholder="Product name"
        [ngClass]="{
          'is-invalid':
            product.get('name')?.invalid && product.get('name')?.touched
        }"
      />
      <div
        *ngIf="product.get('name')?.invalid && product.get('name')?.touched"
        class="text-danger small"
      >
        Product name is required.
      </div>

      <input
        type="number"
        class="form-control mb-2"
        formControlName="price"
        placeholder="Price"
        [ngClass]="{
          'is-invalid':
            product.get('price')?.invalid && product.get('price')?.touched
        }"
      />
      <div
        *ngIf="product.get('price')?.invalid && product.get('price')?.touched"
        class="text-danger small"
      >
        Price must be greater than 0.
      </div>

      <div class="form-check mb-2">
        <input
          type="checkbox"
          class="form-check-input"
          formControlName="is_popular"
          id="popular{{ i }}"
        />
        <label class="form-check-label" for="popular{{ i }}"
          >is Popular Product</label
        >
      </div>

      <button
        type="button"
        class="btn btn-outline-danger btn-sm"
        (click)="removeProduct(i)"
        *ngIf="products.length > 1"
      >
        Remove
      </button>
    </div>
  </div>

  <div class="d-flex gap-2">
    <button type="button" class="btn btn-primary" (click)="addProduct()">
      Add Product
    </button>
    <button
      type="submit"
      class="btn btn-success"
      [disabled]="productbatchForm.invalid"
    >
      Submit
    </button>
  </div>
</form>
